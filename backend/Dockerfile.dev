# Development Dockerfile with Delve debugger
FROM golang:1.24-alpine

WORKDIR /app

# Install git and Delve debugger
RUN apk add --no-cache git curl && \
    go install github.com/go-delve/delve/cmd/dlv@latest

# Copy go mod files first for better caching
COPY go.mod go.sum ./
RUN go mod download

# Copy source code (will be overwritten by volume mount)
COPY . .

# Expose ports: 8000 for app, 2345 for debugger
EXPOSE 8000 2345

# Build at container start (after volume mount), then run with Delve
CMD sh -c "go build -gcflags='all=-N -l' -o /tmp/server ./cmd/server && dlv exec /tmp/server --headless --listen=:2345 --api-version=2 --accept-multiclient --log"
